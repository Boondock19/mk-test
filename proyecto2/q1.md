# Reporte de revenue por pasajero frecuente y su boarding order

```
SELECT
t.passenger_name,
COUNT(DISTINCT(tf.flight_id)) total_flight_count,
SUM(tf.amount) historical_amount_collected,
MAX(bp.boarding_no) max_boarding_number
FROM ticket_flights tf
JOIN tickets t
ON t.ticket_no = tf.ticket_no
JOIN boarding_passes bp
ON bp.ticket_no = t.ticket_no
JOIN flights f
ON bp.flight_id = f.flight_id
WHERE
tf.amount =
(SELECT MAX(tf.amount) FROM ticket_flights tf)
AND
DATE(f.scheduled_departure) BETWEEN '2017-01-26' AND
'2017-06-26'
GROUP BY
t.passenger_name
HAVING
COUNT(DISTINCT(tf.flight_id)) > 3
ORDER BY
COUNT(DISTINCT(tf.flight_id)) DESC;
```